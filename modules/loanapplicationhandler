"use strict";

let mongoose = require("mongoose"),
        db = mongoose.connect(process.env.MONGODB_URI),
        formatter = require('./formatter'),
        LoanApplication = require("../models/loanapplication");

exports.createLoanApp = (userid,update) => {
    console.log(userid + ' ' + update);
    var query = {user_id: userid};
    var options = {upsert: true, returnNewDocument : true};
    return new Promise((resolve, reject) => {
        LoanApplication.findOneAndUpdate(query, update, options, function(err, loanApp) {
            if (err) {
                 reject("An error as occurred");
            } else {
                console.log(loanApp.user_id);
                resolve(loanApp);
            }
        });
    });
};

exports.createFirstQuestion=()=>{
        var options = [
            'Primary','Investment'
        ];
        var postbacks = [
            'primary','investment'
        ];
        var question = 'I will walk you through a series of questions to gather some information. Once we complete these steps, I can send you a preapproval form. So let's get started, what is this property for?';
        return formatter.formatApplicationQuestions(question,postbacks,options);
};
